---
# [ Service Identity ]
tuwunel_service_name: "tuwunel"
tuwunel_livekit_service_name: "livekit"
tuwunel_jwt_service_name: "lk-jwt-service"

# [ Paths & Directories ]
tuwunel_root: "{{ docker_base_dir }}/{{ tuwunel_service_name }}"
tuwunel_compose_dir: "{{ tuwunel_root }}"
tuwunel_config_dir: "{{ tuwunel_root }}/config"
tuwunel_data_dir: "{{ tuwunel_root }}/data"

# [ Docker Images ]
tuwunel_image: "docker.io/jevolk/tuwunel"
tuwunel_image_tag: "{{ docker_image_tag | default('latest') }}"

tuwunel_livekit_image: "livekit/livekit-server"
tuwunel_livekit_tag: "{{ docker_image_tag | default('latest') }}"

tuwunel_jwt_image: "ghcr.io/element-hq/lk-jwt-service"
tuwunel_jwt_tag: "{{ docker_image_tag | default('latest') }}"

# [ Domains & Ingress ]
tuwunel_domain: "{{ matrix_domain | default('matrix.' ~ base_domain) }}"
tuwunel_server_name: "{{ base_domain }}"
tuwunel_livekit_domain: "livekit.{{ base_domain }}"
tuwunel_ingress_provider: "caddy"

# [ Ports ]
tuwunel_port: 8008
tuwunel_livekit_http_port: 7880
tuwunel_livekit_tcp_port: 7881
tuwunel_livekit_udp_start: 50000
tuwunel_livekit_udp_end: 50050
tuwunel_jwt_port: 8081

# [ Configuration ]
tuwunel_restart_policy: "{{ docker_restart_policy | default('unless-stopped') }}"
tuwunel_timezone: "{{ docker_timezone | default('Europe/Moscow') }}"

tuwunel_allow_registration: true
tuwunel_allow_federation: true
tuwunel_allow_encryption: true

# [ Secrets ]
tuwunel_registration_token: "{{ vault_matrix.registration_token | default('') }}"
tuwunel_livekit_key: "{{ vault_matrix.livekit.key }}"
tuwunel_livekit_secret: "{{ vault_matrix.livekit.secret }}"

# [ Network ]
tuwunel_docker_network: "{{ docker_network_name }}"

# [ Integrations ]
tuwunel_enable_autoheal: "{{ use_autoheal | default(true) }}"
tuwunel_use_sablier: false # Matrix must be always online

# [ Performance & Limits ]
tuwunel_max_request_size: 20971520
tuwunel_ulimit_nofile_soft: 1048567
tuwunel_ulimit_nofile_hard: 1048567

# [ Resources ]
tuwunel_memory_limit: "{{ docker_memory_limit | default('384M') }}"
tuwunel_livekit_memory_limit: "{{ docker_memory_limit | default('384M') }}"
tuwunel_jwt_memory_limit: "{{ docker_memory_limit | default('64M') }}"

# [ Logging ]
tuwunel_log_level: "info"
tuwunel_log_colors: true
tuwunel_livekit_log_level: "info"
tuwunel_jwt_log_level: "info"

# [ LDAP Integration ]
tuwunel_ldap_enabled: true
tuwunel_ldap_uri: "ldap://lldap:3890"
tuwunel_ldap_base_dn: "ou=people,dc=ziix,dc=ru"
tuwunel_ldap_bind_dn: "uid={{ vault_identity.lldap.admin_login }},ou=people,dc=ziix,dc=ru"
tuwunel_ldap_bind_password: "{{ vault_identity.lldap.admin_password | default('') }}"
tuwunel_ldap_bind_password_file: "/var/lib/tuwunel/.ldap_bind_password"
tuwunel_ldap_filter: "(&(objectClass=person)(uid={username}))"
tuwunel_ldap_uid_attribute: "uid"
tuwunel_ldap_mail_attribute: "mail"
tuwunel_ldap_name_attribute: "cn"

# [ Healthcheck ]
tuwunel_hc_interval: "{{ docker_hc_interval | default('30s') }}"
tuwunel_hc_timeout: "{{ docker_hc_timeout | default('5s') }}"
tuwunel_hc_retries: "{{ docker_hc_retries | default(3) }}"
